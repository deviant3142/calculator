<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Scientific Calculator</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to top, #1d1d1d, #3a3a3a);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      transition: background 0.5s;
      padding: 20px;
    }

    .calculator {
      width: 95%;
      max-width: 500px;
      background: #111;
      border-radius: 20px;
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
      padding: 20px;
      margin-bottom: 20px;
    }

    .display {
      background: #000;
      color: #0f0;
      font-size: 2em;
      padding: 15px;
      text-align: right;
      border-radius: 10px;
      margin-bottom: 15px;
      min-height: 80px;
      overflow-x: auto;
      word-wrap: break-word;
      font-family: 'Courier New', monospace;
    }

    .expression {
      font-size: 0.6em;
      color: #aaa;
      min-height: 20px;
    }

    .buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
    }

    button {
      padding: 14px;
      font-size: 1.1em;
      border: 2px solid #0ff;
      background: transparent;
      color: #0ff;
      border-radius: 12px;
      transition: all 0.2s ease;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #0ff;
      color: #000;
      transform: scale(1.05);
    }
    button:active {
      transform: scale(0.95);
    }

    .theme-switch {
      margin-top: 15px;
      text-align: center;
    }
    .theme-switch button {
      background: #0f0;
      border: none;
      padding: 10px 20px;
      color: #000;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
    }

    /* Light Theme */
    .light-theme {
      background: linear-gradient(to top, #ffffff, #dddddd);
    }
    .light-theme .calculator {
      background: #f2f2f2;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
    }
    .light-theme .display {
      background: #fff;
      color: #333;
    }
    .light-theme .expression {
      color: #666;
    }
    .light-theme button {
      background: #fff;
      color: #333;
      border: 1px solid #aaa;
    }
    .light-theme button:hover {
      background: #333;
      color: #fff;
    }

    /* Neon Pink Theme */
    .neon-pink {
      background: radial-gradient(circle at top, #330033, #110011);
    }
    .neon-pink .calculator {
      background: #220022;
      box-shadow: 0 0 25px rgba(255, 0, 255, 0.6);
    }
    .neon-pink .display {
      background: #330033;
      color: #ff00ff;
    }
    .neon-pink .expression {
      color: #cc99cc;
    }
    .neon-pink button {
      border: 2px solid #ff00ff;
      color: #ff00ff;
    }
    .neon-pink button:hover {
      background: #ff00ff;
      color: #000;
    }

    /* History */
    #history {
      margin-top: 20px;
      width: 95%;
      max-width: 500px;
      max-height: 160px;
      overflow-y: auto;
      background: rgba(0,0,0,0.6);
      border-radius: 10px;
      padding: 10px;
      color: #fff;
      font-size: 0.9em;
      font-family: monospace;
      box-shadow: inset 0 0 10px rgba(0,255,255,0.2);
    }
    #history strong {
      display: block;
      margin-bottom: 8px;
      text-align: center;
      color: #0ff;
    }
    #history-list div {
      background: rgba(255,255,255,0.05);
      padding: 5px 8px;
      margin-bottom: 5px;
      border-radius: 5px;
      word-break: break-word;
    }
    
    /* Mode indicator */
    .mode-indicator {
      text-align: center;
      color: #0ff;
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    /* Responsive adjustments */
    @media (max-width: 480px) {
      .buttons {
        grid-template-columns: repeat(4, 1fr);
      }
      button {
        padding: 12px;
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <div class="calculator">
    <div class="mode-indicator" id="modeIndicator">Scientific Mode</div>
    <div class="display">
      <div class="expression" id="expression"></div>
      <div id="display">0</div>
    </div>
    <div class="buttons">
      <button onclick="clearDisplay()">C</button>
      <button onclick="backspace()">←</button>
      <button onclick="append('%')">%</button>
      <button onclick="append('/')">÷</button>
      <button onclick="calculate()">=</button>

      <button onclick="append('7')">7</button>
      <button onclick="append('8')">8</button>
      <button onclick="append('9')">9</button>
      <button onclick="append('*')">×</button>
      <button id="powBtn" onclick="append('^')">xʸ</button>

      <button onclick="append('4')">4</button>
      <button onclick="append('5')">5</button>
      <button onclick="append('6')">6</button>
      <button onclick="append('-')">−</button>
      <button id="sqrtBtn" onclick="append('√(')">√</button>

      <button onclick="append('1')">1</button>
      <button onclick="append('2')">2</button>
      <button onclick="append('3')">3</button>
      <button onclick="append('+')">+</button>
      <button onclick="append('!')">n!</button>

      <button onclick="append('0')">0</button>
      <button onclick="append('.')">.</button>
      <button onclick="append('π')">π</button>
      <button onclick="append('e')">e</button>
      <button onclick="append('(')">(</button>

      <button onclick="append(')')">)</button>
      <button id="sinBtn" onclick="append('sin(')">sin</button>
      <button id="cosBtn" onclick="append('cos(')">cos</button>
      <button id="tanBtn" onclick="append('tan(')">tan</button>
      <button id="logBtn" onclick="append('log(')">log</button>

      <button id="lnBtn" onclick="append('ln(')">ln</button>
      <button id="modBtn" onclick="append('%')">mod</button>
      <button id="absBtn" onclick="append('abs(')">abs</button>
      <button id="expBtn" onclick="append('exp(')">exp</button>
      <button id="pow10Btn" onclick="append('10^(')">10ˣ</button>
    </div>
    <div class="theme-switch">
      <button onclick="toggleTheme()">Change Theme</button>
      <button onclick="toggleSecond()">2nd</button>
      <button onclick="toggleMode()">Mode</button>
    </div>
  </div>

  <div id="history">
    <strong>History</strong>
    <div id="history-list"></div>
  </div>

  <script>
    const display = document.getElementById('display');
    const expression = document.getElementById('expression');
    const historyList = document.getElementById('history-list');
    const modeIndicator = document.getElementById('modeIndicator');
    
    let themeIndex = 0;
    const themes = ['default', 'light-theme', 'neon-pink'];
    let secondMode = false;
    let mode = 'scientific'; // scientific, programming, statistics
    
    let currentExpression = '';

    function append(char) {
      if (char === 'π') {
        display.innerText = (display.innerText === '0') ? Math.PI.toFixed(5) : display.innerText + Math.PI.toFixed(5);
      } else if (char === 'e') {
        display.innerText = (display.innerText === '0') ? Math.E.toFixed(5) : display.innerText + Math.E.toFixed(5);
      } else {
        display.innerText = (display.innerText === '0') ? char : display.innerText + char;
      }
      currentExpression = display.innerText;
    }

    function clearDisplay() { 
      display.innerText = '0'; 
      expression.innerText = '';
      currentExpression = '';
    }
    
    function backspace() { 
      display.innerText = display.innerText.slice(0, -1) || '0'; 
      currentExpression = display.innerText;
    }

    function factorial(n) { 
      if (n < 0) throw new Error("Factorial of negative number");
      return n <= 1 ? 1 : n * factorial(n - 1); 
    }

    function calculate() {
      try {
        let expr = display.innerText;
        expression.innerText = expr;

        // Replace constants
        expr = expr.replace(/π/g, Math.PI);
        expr = expr.replace(/e/g, Math.E);
        
        // Replace functions
        expr = expr.replace(/√/g, "Math.sqrt");
        expr = expr.replace(/sin\(/g, "Math.sin(");
        expr = expr.replace(/cos\(/g, "Math.cos(");
        expr = expr.replace(/tan\(/g, "Math.tan(");
        expr = expr.replace(/asin\(/g, "Math.asin(");
        expr = expr.replace(/acos\(/g, "Math.acos(");
        expr = expr.replace(/atan\(/g, "Math.atan(");
        expr = expr.replace(/log\(/g, "Math.log10(");
        expr = expr.replace(/ln\(/g, "Math.log(");
        expr = expr.replace(/exp\(/g, "Math.exp(");
        expr = expr.replace(/abs\(/g, "Math.abs(");
        
        // Handle factorial
        expr = expr.replace(/(\d+)!/g, (_,n) => factorial(parseInt(n))); 
        
        // Handle powers
        expr = expr.replace(/\^/g, "**");
        
        // Handle 10^x and e^x when in 2nd mode
        expr = expr.replace(/10\^\(/g, "(10**(");
        expr = expr.replace(/e\^\(/g, "(" + Math.E + "**(");

        // Handle percentage
        if (expr.includes('%')) {
          const parts = expr.split('%');
          if (parts.length === 2) {
            expr = `(${parts[0]}) * (${parts[1]}) / 100`;
          }
        }

        let result = eval(expr);
        
        // Format result for display
        if (Number.isInteger(result)) {
          display.innerText = result;
        } else {
          display.innerText = parseFloat(result.toPrecision(12));
        }
        
        let shown = expression.innerText + " = " + display.innerText;
        addToHistory(shown);
        
        // Keep expression for next calculation
        currentExpression = display.innerText;
      } catch (error) {
        display.innerText = 'Error';
        console.error(error);
      }
    }

    function toggleTheme() {
      document.body.classList.remove(...themes);
      themeIndex = (themeIndex + 1) % themes.length;
      if (themes[themeIndex] !== 'default') {
        document.body.classList.add(themes[themeIndex]);
      }
    }

    function addToHistory(entry) {
      const line = document.createElement('div');
      line.textContent = entry;
      historyList.prepend(line);
    }

    // Toggle 2nd Functions
    function toggleSecond() {
      secondMode = !secondMode;
      
      document.getElementById("sinBtn").innerText = secondMode ? "asin" : "sin";
      document.getElementById("sinBtn").setAttribute("onclick", secondMode ? "append('asin(')" : "append('sin(')");

      document.getElementById("cosBtn").innerText = secondMode ? "acos" : "cos";
      document.getElementById("cosBtn").setAttribute("onclick", secondMode ? "append('acos(')" : "append('cos(')");

      document.getElementById("tanBtn").innerText = secondMode ? "atan" : "tan";
      document.getElementById("tanBtn").setAttribute("onclick", secondMode ? "append('atan(')" : "append('tan(')");

      document.getElementById("logBtn").innerText = secondMode ? "10^x" : "log";
      document.getElementById("logBtn").setAttribute("onclick", secondMode ? "append('10^(')" : "append('log(')");

      document.getElementById("lnBtn").innerText = secondMode ? "e^x" : "ln";
      document.getElementById("lnBtn").setAttribute("onclick", secondMode ? "append('e^(')" : "append('ln(')");

      document.getElementById("sqrtBtn").innerText = secondMode ? "x²" : "√";
      document.getElementById("sqrtBtn").setAttribute("onclick", secondMode ? "append('^2')" : "append('√(')");

      document.getElementById("powBtn").innerText = secondMode ? "x³" : "xʸ";
      document.getElementById("powBtn").setAttribute("onclick", secondMode ? "append('^3')" : "append('^')");
      
      document.getElementById("modBtn").innerText = secondMode ? "rand" : "mod";
      document.getElementById("modBtn").setAttribute("onclick", secondMode ? "append(Math.random().toFixed(5))" : "append('%')");
      
      document.getElementById("absBtn").innerText = secondMode ? "floor" : "abs";
      document.getElementById("absBtn").setAttribute("onclick", secondMode ? "append('Math.floor(')" : "append('abs(')");
      
      document.getElementById("expBtn").innerText = secondMode ? "ceil" : "exp";
      document.getElementById("expBtn").setAttribute("onclick", secondMode ? "append('Math.ceil(')" : "append('exp(')");
      
      document.getElementById("pow10Btn").innerText = secondMode ? "round" : "10ˣ";
      document.getElementById("pow10Btn").setAttribute("onclick", secondMode ? "append('Math.round(')" : "append('10^(')");
    }
    
    // Toggle between modes
    function toggleMode() {
      if (mode === 'scientific') {
        mode = 'programming';
        modeIndicator.innerText = 'Programming Mode';
        // Add programming functions
      } else if (mode === 'programming') {
        mode = 'statistics';
        modeIndicator.innerText = 'Statistics Mode';
        // Add statistics functions
      } else {
        mode = 'scientific';
        modeIndicator.innerText = 'Scientific Mode';
      }
    }

    // Keyboard Support
    document.addEventListener('keydown', (e) => {
      if (/\d/.test(e.key)) append(e.key);
      if (['+', '-', '*', '/', '.', '%', '^'].includes(e.key)) append(e.key);
      if (e.key === 'Enter') calculate();
      if (e.key === 'Backspace') backspace();
      if (e.key.toLowerCase() === 'c') clearDisplay();
      if (e.key === '(') append('(');
      if (e.key === ')') append(')');
    });
  </script>
</body>
</html>